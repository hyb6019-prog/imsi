<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
	.pay-wrap{
		width: 1000px;
		margin: 0 auto;
	}
	.product-wrap{
		display: flex;
		justify-content: space-around;
	}
	.product-wrap>div{
		width:450px;
		height:300px;
	}
	.product-img>img{
		width: 100%;
		height: 100%;
		object-fit : contain;
	}
</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<main class="content">
		<section class="section pay-wrap">
			<div class="page-title">상품판매</div>
			<div class="product-wrap">
				<div class="product-img">
					<img src="/photo/dora.png">
				</div>
				<div class="product-info">
					<table class="tbl">
						<tr>
							<td class="left" colspan="2">도라에몽</td>
						</tr>
						<tr>
							<th style="width:30%">제조사</th>
							<td>장난감회사</td>
						</tr>
						<tr>
							<th>가격</th>
							<td>
								<span id="product-price">5000</span>
								<span>원</span>
							</td>
						</tr>
						<tr>
							<th>주문수량</th>
							<td>
								<button class="btn-point sm minus">-</button>
								<span id="product-amount">1</span>
								<button class="btn-point sm plus">+</button>
							</td>
						</tr>
						<tr>
							<th>총 가격</th>
							<td>
							 <span id="total-price">5000</span>
							 <span>원</span>
							</td>
						</tr>
						<tr>
							<td colspan="2">
								<button id="buy-button" class="btn-primary">구매하기</button>
								<button id="cart-button" class="btn-point">장바구니</button>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</section>
	</main>
	<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
	<script>
		$(".plus").on("click", function(){
			const productPrice = $("#product-price").text();
			const productAmount = $("#product-amount").text();
			
			const newAmount = Number(productAmount) + 1;
			const newTotalPrice = newAmount * productPrice;
			$("#product-amount").text(newAmount);
			$("#total-price").text(newTotalPrice);
		});
		$(".minus").on("click", function(){
			const productPrice = $("#product-price").text();
			const productAmount = $("#product-amount").text();
			if(productAmount === "1") {
				alert("최소 주문수량은 1개입니다.")
				return;
			}
			const newAmount = Number(productAmount) - 1;
			const newTotalPrice = newAmount * productPrice;
			$("#product-amount").text(newAmount);
			$("#total-price").text(newTotalPrice);
		});
		$("#buy-button").on("click", function(){
			const price = $("#total-price").text();
			console.log("총 결제금액 : "+price);
			const date = new Date();
			const dateString = `${date.getFullYear()}${date.getMonth()+1}${date.getDate()}${date.getHours()}${date.getMinutes()}${date.getSeconds()}`;
			IMP.init("imp27182461");
			IMP.request_pay(
					  {
					    channelKey: "{콘솔 내 연동 정보의 채널키}",
					    pay_method: "card",
					    merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
					    name: "주문명:결제테스트",
					    amount: price,
					    buyer_email: "test@portone.io",
					    buyer_name: "구매자이름",
					    buyer_tel: "010-1234-5678", //필수 파라미터 입니다.
					    buyer_addr: "서울특별시 강남구 삼성동",
					    buyer_postcode: "123-456",
					    m_redirect_url: "{모바일에서 결제 완료 후 리디렉션 될 URL}",
					    escrow: true, //에스크로 결제인 경우 설정
					    vbank_due: "YYYYMMDD",
					    bypass: {
					      // PC 경우
					      acceptmethod: "noeasypay", // 간편결제 버튼을 통합결제창에서 제외(PC)
					      // acceptmethod: "cardpoint", // 카드포인트 사용시 설정(PC)
					      // 모바일 경우
					      P_RESERVED: "noeasypay=Y", // 간편결제 버튼을 통합결제창에서 제외(모바일)
					      // P_RESERVED: "cp_yn=Y", // 카드포인트 사용시 설정(모바일)
					      // P_RESERVED: "twotrs_bank=Y&iosapp=Y&app_scheme=your_app_scheme://", // iOS에서 계좌이체시 결제가 이뤄지던 앱으로 돌아가기
					    },
					    period: {
					      from: "20200101", //YYYYMMDD
					      to: "20201231", //YYYYMMDD
					    },
					  },
					  function (rsp) {
					    // callback 로직
					    //* ...중략... *//
					  },
					);
		});
	</script>
	<th:block th:include="common/footer"></th:block>
</body>
</html>




















